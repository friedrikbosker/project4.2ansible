- name: Installing bind-utils
  yum:
    name: 
    - bind-utils
    - freeipa-client
    state: present

- name: Setting the hostname
  shell: |
    hostname ipa-client.groep5uvd.nl

- name: Opening Splunk ports
  shell: |
    firewall-cmd --permanent --add-port 80/tcp
    firewall-cmd --permanent --add-port 88/tcp
    firewall-cmd --permanent --add-port 88/udp
    firewall-cmd --permanent --add-port 389/tcp
    firewall-cmd --permanent --add-port 464/tcp
    firewall-cmd --permanent --add-port 464/udp
    firewall-cmd --permanent --add-port 123/tcp
    firewall-cmd --reload
    
- name: FreeIpa installation
  expect:
    command: ipa-client-install --mkhomedir
    responses:
      "Provide the domain name of your IPA server (ex: example.com):": "ipa.groep5uvd.nl"
      "Provide your IPA server name (ex: ipa.example.com):": "g05-ipa.groep5uvd.nl"
      "Proceed with fixed values and no DNS discovery? [no]:": "yes"
      "Continue to configure the system with these values? [no]:": "yes"
      "User authorized to enroll computers:": "admin"
    timeout: 180
